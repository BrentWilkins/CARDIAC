var c=document.getElementById("step");c.addEventListener("click",d);c=document.getElementById("run");c.addEventListener("click",e);c=document.getElementById("stop");c.addEventListener("click",f);c=document.getElementById("reset");c.addEventListener("click",g);function g(){mode=0;k(0);pc=0;acEl.value="0000";pcEl.value="00";instEl.value="";outputEl.value=""}function f(){mode=0}function l(){0==mode?clearInterval(timerId):d()}function e(){mode=1;timerId=setInterval(l,delay)}
function m(b,h){document.getElementById("mem"+pad(b,2)).value=pad(h,3)}function n(b){return Number(document.getElementById("mem"+pad(b,2)).value)}function k(b){p();addrElPP=document.getElementById("mem"+pad(b,2)).parentElement.parentElement;addrElPP.classList.add("has-warning")}function q(b){lastOP&&lastOP.classList.remove("info");lastOP=document.getElementById(b);lastOP.classList.add("info")}function p(){addrElPP&&addrElPP.classList.remove("has-warning")}
function d(){inputs=document.getElementById("input").value.split("\n");inIndex=0;var b=document.getElementById("mem"+pad(pc,2));inst=b.value;instEl.value=pad(inst,3);var h=Math.floor(inst/100),a=inst%100;pcEl.value=pad(++pc,2);b.parentElement.parentElement.classList.remove("has-success");switch(h){case 0:if(inIndex>=inputs.length||""==inputs[inIndex])pc=mode=0;else for(m(a,Number(inputs[inIndex])),inIndex++,input.value="",i=inIndex;i<inputs.length;++i)input.value+=inputs[i]+"\n";q("INP");k(a);break;
case 1:ac=n(a);acEl.value=pad(ac,4);q("CLA");k(a);break;case 2:ac+=n(a);acEl.value=pad(ac,4);break;case 3:0>ac&&(pc=a);q("TAC");k(a);break;case 4:b=Math.floor(a/10);a%=10;for(i=0;i<b;++i)acc=10*acc%1E4;for(i=0;i<a;++i)ac=Math.floor(acc/10);acEl.value=pad(ac,4);q("SFT");p();break;case 5:outputEl.value+=pad(n(a),3)+"\n";q("OUT");k(a);break;case 6:m(a,pad(ac,3));q("STO");k(a);break;case 7:ac-=n(a);acEl.value=pad(ac,4);q("SUB");k(a);break;case 8:m(99,pc+800);pc=a;q("JMP");k(a);break;default:mode=0,pc=
a,q("HRS"),p()}pcEl.value=pad(pc,2);document.getElementById("mem"+pad(pc,2)).parentElement.parentElement.classList.add("has-success")};